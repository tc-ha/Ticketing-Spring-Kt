# k6 부하 테스트 결과 리포트

**테스트 일시**: 2025-12-22
**테스트 환경**: Spring Boot + MySQL 8.0 + Pessimistic Lock (SELECT FOR UPDATE)
**테스트 시나리오**: 티켓 오픈 시뮬레이션 (100 VUs, 30초 지속)
**반복 횟수**: 10회

---

## 1. 테스트 설정

| 항목 | 값 |
|------|-----|
| 동시 사용자 (VUs) | 100 |
| 테스트 시간 | 30초 |
| 초기 재고 | 100개 |
| DB Lock 방식 | Pessimistic Write Lock (SELECT FOR UPDATE) |
| 비즈니스 로직 지연 | 100ms (결제 연동 시뮬레이션) |
| HikariCP 풀 사이즈 | 20 |

---

## 2. 처리량 (Throughput)

### 라운드별 RPS (Requests Per Second)

| 라운드 | RPS | 총 요청 수 |
|--------|-----|-----------|
| 1 | 796.99 | 23,952 |
| 2 | 657.99 | 19,773 |
| 3 | 934.56 | 28,083 |
| 4 | 953.89 | 28,670 |
| 5 | 969.61 | 29,141 |
| 6 | 947.05 | 28,466 |
| 7 | 884.16 | 26,599 |
| 8 | 860.97 | 25,898 |
| 9 | 890.79 | 26,786 |
| 10 | 777.89 | 23,383 |

### 요약

| 지표 | 값 |
|------|-----|
| **평균 RPS** | **867.39** |
| 최대 RPS | 969.61 (라운드 5) |
| 최소 RPS | 657.99 (라운드 2) |
| 총 처리 요청 수 | 260,751 |

---

## 3. 응답 시간 (Response Time)

### 라운드별 응답 시간 (ms)

| 라운드 | p50 | p90 | p95 | avg | max |
|--------|-----|-----|-----|-----|-----|
| 1 | 64.19 | 94.71 | 127.56 | 125.28 | 11,971.72 |
| 2 | 67.35 | 143.11 | 244.37 | 151.76 | 11,248.24 |
| 3 | 64.00 | 76.00 | 83.69 | 106.84 | 11,281.56 |
| 4 | 62.93 | 74.88 | 82.25 | 104.66 | 11,267.92 |
| 5 | 62.37 | 73.58 | 78.61 | 102.97 | 11,219.21 |
| 6 | 63.59 | 75.07 | 78.99 | 105.42 | 11,220.01 |
| 7 | 63.57 | 81.95 | 106.22 | 112.88 | 11,277.25 |
| 8 | 66.91 | 88.59 | 122.36 | 115.89 | 11,213.83 |
| 9 | 64.78 | 85.89 | 112.21 | 112.05 | 11,215.30 |
| 10 | 69.60 | 112.35 | 145.13 | 128.34 | 11,287.80 |

### 요약

| 지표 | 값 |
|------|-----|
| **평균 p50** | **64.93ms** |
| **평균 p90** | **90.61ms** |
| **평균 p95** | **118.14ms** |
| 평균 avg | 116.61ms |
| 최대 응답시간 | ~11,970ms |

---

## 4. 성공률 분석

### 라운드별 결과

| 라운드 | SUCCESS | SOLD_OUT | 총 요청 | 성공률 |
|--------|---------|----------|---------|--------|
| 1 | 100 | 23,852 | 23,952 | 0.42% |
| 2 | 100 | 19,673 | 19,773 | 0.51% |
| 3 | 100 | 27,983 | 28,083 | 0.36% |
| 4 | 100 | 28,570 | 28,670 | 0.35% |
| 5 | 100 | 29,041 | 29,141 | 0.34% |
| 6 | 100 | 28,366 | 28,466 | 0.35% |
| 7 | 100 | 26,499 | 26,599 | 0.38% |
| 8 | 100 | 25,798 | 25,898 | 0.39% |
| 9 | 100 | 26,686 | 26,786 | 0.37% |
| 10 | 100 | 23,283 | 23,383 | 0.43% |

### 요약

| 지표 | 값 |
|------|-----|
| **총 SUCCESS** | **1,000** (정확히 10라운드 x 100개) |
| **총 SOLD_OUT** | **259,751** |
| HTTP 에러 | **0** (모든 요청 정상 응답) |
| 전체 성공률 | 0.38% |

> **결과 해석**: 모든 라운드에서 정확히 100개의 티켓만 판매되었습니다.
> 이는 Pessimistic Lock이 동시성 문제를 완벽하게 해결했음을 의미합니다.
> 재고 초과 판매(overselling) 없이 정확한 재고 관리가 이루어졌습니다.

---

## 5. DB 락 대기 시간 분석

### 성공 요청 vs SOLD_OUT 요청 응답 시간 비교

| 라운드 | SUCCESS avg (ms) | SOLD_OUT avg (ms) | 차이 (ms) |
|--------|------------------|-------------------|-----------|
| 1 | 6,085.81 | 100.29 | 5,985.52 |
| 2 | 5,695.79 | 123.58 | 5,572.21 |
| 3 | 5,720.05 | 86.78 | 5,633.27 |
| 4 | 5,684.75 | 85.13 | 5,599.62 |
| 5 | 5,670.85 | 83.80 | 5,587.05 |
| 6 | 5,683.93 | 85.39 | 5,598.54 |
| 7 | 5,699.61 | 91.48 | 5,608.13 |
| 8 | 5,661.37 | 96.28 | 5,565.09 |
| 9 | 5,670.09 | 90.86 | 5,579.23 |
| 10 | 5,717.87 | 104.33 | 5,613.54 |

### 요약

| 지표 | 값 |
|------|-----|
| **성공 요청 평균 응답시간** | **5,729.01ms** |
| **SOLD_OUT 평균 응답시간** | **94.71ms** |
| **추정 DB 락 대기 시간** | **5,629.01ms** |

### DB 락 대기 시간 상세 분석

```
성공 요청 응답시간 구성:
├── 비즈니스 로직 (Thread.sleep): 100ms
├── DB 트랜잭션 처리: ~30ms
└── DB 락 대기 시간: ~5,600ms (병목 구간)

SOLD_OUT 요청 응답시간 구성:
├── DB 락 대기 시간: ~60-90ms
└── 재고 확인 후 즉시 반환: ~5-10ms
```

---

## 6. 병목 구간 분석

### 병목 원인

1. **Pessimistic Lock (SELECT FOR UPDATE)**
   - 100개의 VU가 동시에 같은 Row에 락을 시도
   - 한 번에 하나의 트랜잭션만 락 획득 가능
   - 나머지 99개는 대기 상태

2. **트랜잭션 처리 시간**
   - 비즈니스 로직 100ms (결제 시뮬레이션)
   - DB 쓰기 작업 ~30ms
   - 총 ~130ms 동안 락 점유

3. **성공 요청의 긴 응답시간**
   - 100개의 성공 요청이 순차적으로 처리됨
   - 마지막 성공 요청: 약 100 x 100ms = 10,000ms+ 대기
   - 평균 대기 시간: (1+2+...+100) x 100ms / 100 = ~5,050ms

### 처리량 제한 요인

| 요인 | 영향 |
|------|------|
| 락 경합 | 동시 요청이 많을수록 대기 시간 증가 |
| 트랜잭션 시간 | 100ms 비즈니스 로직이 처리량 제한 |
| 커넥션 풀 | 20개로 제한되어 병목 가능성 |

---

## 7. 결론

### 테스트 결과 요약

| 항목 | 결과 | 평가 |
|------|------|------|
| 데이터 정합성 | 모든 라운드에서 정확히 100개 판매 | **우수** |
| HTTP 에러율 | 0% | **우수** |
| 평균 처리량 | 867 RPS | 양호 |
| p95 응답시간 | 118ms (SOLD_OUT 포함) | 양호 |
| 성공 요청 응답시간 | 5,729ms (평균) | 개선 필요 |

### 장점

- **완벽한 동시성 제어**: Pessimistic Lock으로 재고 초과 판매 방지
- **높은 안정성**: HTTP 에러 없이 모든 요청 처리
- **빠른 실패 응답**: SOLD_OUT 응답은 평균 95ms로 신속

### 개선 권장사항

1. **락 대기 시간 감소**
   - Redis 분산 락 도입 검토
   - Optimistic Lock으로 전환 (재시도 로직 필요)

2. **트랜잭션 시간 최소화**
   - 비동기 결제 처리 (이벤트 기반)
   - 락 점유 시간 최소화

3. **수평 확장**
   - 대기열 시스템 도입 (Redis Queue)
   - 요청 순차 처리로 락 경합 감소

---

## 8. 원시 데이터

테스트 결과 JSON 파일: `result_1.json` ~ `result_10.json`
테스트 출력 로그: `output_1.txt` ~ `output_10.txt`
